<html>
  <head>
    <title>Booking Armada - YasaTravel</title>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="media/YasaBulett.png" type="image/png" />

    <!-- Link ke File CSS -->
    <link rel="stylesheet" href="Gaya.css" />

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <!-- Header (Sama seperti halaman lain) -->
    <header class="main-header">
      <div class="container header-container">
        <a href="Index.html" class="logo">
          Yasa<span class="logo-accent">Travel</span>
        </a>
        <nav class="main-nav">
          <a href="Index.html">Beranda</a>
          <a href="TentangKami.html">Tentang Kami</a>
          <a href="Kontak.html">Kontak</a>
        </nav>
      </div>
      <!-- Mobile Menu -->
      <div id="mobile-menu" class="mobile-menu-dropdown">
        <a href="Index.html">Beranda</a>
        <a href="TentangKami.html">Tentang Kami</a>
        <a href="Kontak.html">Kontak</a>
      </div>
    </header>

    <main class="booking-page-main">
      <div class="container">
        <div class="booking-layout">
          <!-- Kolom Kiri: Detail & Form -->
          <div class="booking-details">
            <h1>Detail Pemesanan</h1>
            <p class="subtitle">
              Lengkapi detail perjalanan dan data diri Anda di bawah ini.
            </p>

            <!-- Detail Armada yang Dipesan -->
            <div class="armada-summary-card">
              <img
                id="booking-armada-img"
                src="https://placehold.co/600x400/e2e8f0/334155?text=Pilih+Armada"
                alt="Armada"
              />
              <div class="armada-info">
                <h3 id="booking-armada-name">
                  Pilih Armada dari Halaman Utama
                </h3>
                <div class="armada-specs">
                  <span
                    ><i data-lucide="users"></i>
                    <span id="booking-armada-capacity">...</span></span
                  >
                  <span><i data-lucide="snowflake"></i> Full AC</span>
                  <span><i data-lucide="music"></i> Audio System</span>
                </div>
              </div>
            </div>

            <!-- Form Pemesanan -->
            <form id="booking-form" class="main-booking-form">
              <div class="form-section">
                <h4>1. Detail Perjalanan</h4>
                <div class="form-row">
                  <div class="form-group">
                    <label for="booking-pickup-address"
                      >Alamat Penjemputan</label
                    >
                    <input
                      type="text"
                      id="booking-pickup-address"
                      required
                      placeholder="Jl. Contoh No. 123, Kota Anda"
                    />
                  </div>
                  <div class="form-group">
                    <label for="booking-destination-address"
                      >Alamat Tujuan Utama</label
                    >
                    <input
                      type="text"
                      id="booking-destination-address"
                      required
                      placeholder="Nama tempat wisata atau alamat tujuan"
                    />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="booking-pickup-date">Tanggal Berangkat</label>
                    <input type="date" id="booking-pickup-date" required />
                  </div>
                  <div class="form-group">
                    <label for="booking-end-date">Tanggal Selesai</label>
                    <input type="date" id="booking-end-date" required />
                  </div>
                </div>
              </div>

              <div class="form-section">
                <h4>2. Data Pemesan</h4>
                <div class="form-row">
                  <div class="form-group">
                    <label for="full-name">Nama Lengkap</label>
                    <input
                      type="text"
                      id="full-name"
                      required
                      placeholder="Sesuai KTP"
                    />
                  </div>
                  <div class="form-group">
                    <label for="phone-number">Nomor Telepon (WhatsApp)</label>
                    <input
                      type="tel"
                      id="phone-number"
                      required
                      placeholder="081234567890"
                    />
                  </div>
                </div>
              </div>
            </form>
          </div>

          <!-- Kolom Kanan: Ringkasan & Pembayaran -->
          <aside class="booking-summary">
            <h3>Ringkasan Biaya</h3>
            <div class="price-details">
              <div class="price-item">
                <span id="summary-armada-text">Sewa Armada</span>
                <span id="summary-armada-price">Rp 0</span>
              </div>
              <div class="price-item">
                <span>Biaya Layanan</span>
                <span>Rp 20.000</span>
              </div>
              <div class="price-total">
                <span>Total Pembayaran</span>
                <span class="total-amount" id="summary-total-price"
                  >Rp 20.000</span
                >
              </div>
            </div>
            <button
              id="whatsapp-button"
              class="btn btn-primary btn-full whatsapp-btn"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"
                ></path>
                <path d="M14.05 2a9 9 0 0 1 8 7.94"></path>
                <path d="M14.05 6A5 5 0 0 1 18 10"></path>
              </svg>
              <span>Lanjutkan di WhatsApp</span>
            </button>
            <div class="secure-info">
              <i data-lucide="lock"></i>
              <span>Data Anda aman dan terenkripsi.</span>
            </div>
          </aside>
        </div>
      </div>
    </main>

    <script>
      // Initialize Lucide Icons
      lucide.createIcons();

      // --- SCRIPT UNTUK MENGISI DATA OTOMATIS ---
      document.addEventListener("DOMContentLoaded", () => {
        const bookingDataString = sessionStorage.getItem("bookingData");
        if (!bookingDataString) {
          console.log("Tidak ada data booking di sessionStorage.");
          return;
        }

        const data = JSON.parse(bookingDataString);
        console.log("Data booking ditemukan:", data);

        const armadaInfo = {
          hiace: {
            name: "Hiace Commuter",
            capacity: "Hingga 16 Penumpang",
            price: 1200000,
            img: "https://placehold.co/600x400/e2e8f0/334155?text=Hiace+Commuter",
          },
          "hiace-premio": {
            name: "Hiace Premio",
            capacity: "Hingga 18 Penumpang",
            price: 1550000,
            img: "https://placehold.co/600x400/e2e8f0/334155?text=Hiace+Premio",
          },
          "bus-medium": {
            name: "Bus Medium",
            capacity: "Hingga 35 Penumpang",
            price: 3000000,
            img: "https://placehold.co/600x400/e2e8f0/334155?text=Medium+Bus",
          },
        };

        const selectedArmada = armadaInfo[data.armadaType];

        // 1. Isi form dengan data yang diterima
        document.getElementById("booking-pickup-address").value = data.pickup;
        document.getElementById("booking-destination-address").value =
          data.destination;
        document.getElementById("booking-pickup-date").value = data.dateStart;
        document.getElementById("booking-end-date").value = data.dateEnd;

        // 2. Perbarui detail kartu armada
        if (selectedArmada) {
          document.getElementById("booking-armada-img").src =
            selectedArmada.img;
          document.getElementById("booking-armada-name").textContent =
            selectedArmada.name;
          document.getElementById("booking-armada-capacity").textContent =
            selectedArmada.capacity;
        }

        // 3. Hitung durasi dan total biaya
        const tglMulai = new Date(data.dateStart);
        const tglSelesai = new Date(data.dateEnd);

        if (
          selectedArmada &&
          !isNaN(tglMulai) &&
          !isNaN(tglSelesai) &&
          tglSelesai >= tglMulai
        ) {
          const diffTime = Math.abs(tglSelesai - tglMulai);
          let durasiHari = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // +1 karena hari akhir dihitung

          const hargaPerHari = selectedArmada.price;
          const biayaSewa = hargaPerHari * durasiHari;
          const biayaLayanan = 20000;
          const totalBiaya = biayaSewa + biayaLayanan;

          // 4. Tampilkan hasil perhitungan di ringkasan biaya
          document.getElementById(
            "summary-armada-text"
          ).textContent = `Sewa ${selectedArmada.name} x ${durasiHari} hari`;
          document.getElementById(
            "summary-armada-price"
          ).textContent = `Rp ${biayaSewa.toLocaleString("id-ID")}`;
          document.getElementById(
            "summary-total-price"
          ).textContent = `Rp ${totalBiaya.toLocaleString("id-ID")}`;
        }
      });
      // --- SCRIPT BARU UNTUK TOMBOL WHATSAPP ---
      const whatsappButton = document.getElementById("whatsapp-button");

      whatsappButton.addEventListener("click", () => {
        // 1. Ambil semua data yang relevan dari halaman
        const pickup = document.getElementById("booking-pickup-address").value;
        const destination = document.getElementById(
          "booking-destination-address"
        ).value;
        const dateStart = document.getElementById("booking-pickup-date").value;
        const dateEnd = document.getElementById("booking-end-date").value;
        const armadaName = document.getElementById(
          "booking-armada-name"
        ).textContent;
        const fullName = document.getElementById("full-name").value;
        const phone = document.getElementById("phone-number").value;

        // Validasi sederhana: pastikan nama dan nomor telepon diisi
        if (!fullName || !phone) {
          alert(
            "Harap isi Nama Lengkap dan Nomor Telepon Anda terlebih dahulu."
          );
          return; // Hentikan proses jika belum diisi
        }

        // 2. Format tanggal agar lebih mudah dibaca
        const formatDate = (dateString) => {
          const options = { year: "numeric", month: "long", day: "numeric" };
          return new Date(dateString).toLocaleDateString("id-ID", options);
        };

        // 3. Buat template pesan
        const message = `Hai Kak, saya ${fullName} mau booking:
- Rute: ${pickup} - ${destination}
- Tanggal: ${formatDate(dateStart)} - ${formatDate(dateEnd)}
- Armada: ${armadaName}

Mohon info ketersediaan dan detail selanjutnya. Terima kasih.`;

        // 4. Ganti dengan nomor WhatsApp Anda (gunakan format 62, bukan 0)
        const yourWhatsAppNumber = "62818104008";

        // 5. Buat URL WhatsApp
        const whatsappURL = `https://wa.me/${yourWhatsAppNumber}?text=${encodeURIComponent(
          message
        )}`;

        // 6. Buka WhatsApp di tab baru
        window.open(whatsappURL, "_blank");
      });
    </script>
  </body>
</html>
